{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Enable Programmatic Access to Google Analytics Data","text":"<p>The Google Analytics Data API allows you to programmatically access your Google Analytics data. This can be useful if you want to do things like; automate data extraction, integrate analytics data into your applications, or perform advanced data analysis.</p> <p>This guide describes how to set up a Google Cloud project with the appropriate credentials, to enable fetching data using the Google Analytics Data API.</p>"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>A Google Cloud account.</li> <li>A Google Analytics property to set up access to.</li> <li>gcloud command line tool installed. See the gcloud installation guide for instructions.</li> </ul>"},{"location":"#step-1-create-google-cloud-project","title":"Step 1: Create Google Cloud Project","text":"<p>To create a Google Cloud project:</p> <ol> <li> <p>Open the Google Cloud Console.</p> </li> <li> <p>Select the Open Project Picker button () in the top left corner.</p> </li> <li> <p>Select the New Project button.</p> <p></p> </li> <li> <p>Enter the following information:</p> <ul> <li>Project name</li> <li>If applicable, your Organization.</li> <li> <p>If applicable, a Location.</p> <p></p> </li> </ul> </li> <li> <p>Select Create, to create the project.</p> <p>Note</p> <p>If you have several Google accounts, make sure you are logged in with the account that you want to connect the project to.</p> </li> </ol>"},{"location":"#step-2-enable-google-analytics-data-api","title":"Step 2: Enable Google Analytics Data API","text":"<p>To enable the Google Analytics Data API for your project:</p> <ol> <li> <p>The new Google Cloud project is not automatically opened in the Console. To open the project, select the Open Project Picker button () in the top left corner and select the project.</p> </li> <li> <p>Select the hamburger menu in the top left corner and select APIs &amp; Services &gt; Enable APIs &amp; Services.</p> <p></p> </li> <li> <p>Select the + Enable APIs and Services button.</p> </li> <li> <p>Enter Google Analytics Data API in the search bar and press Enter.</p> <p></p> </li> <li> <p>Select Google Analytics Data API.</p> </li> <li> <p>Select the Enable button, to enable the API for your project.</p> </li> </ol>"},{"location":"#step-3-create-service-account-and-keys","title":"Step 3: Create Service Account and Keys","text":"<p>API credentials are required to authenticate your requests. To create a service account and generate a key:</p> <ol> <li> <p>Select the hamburger menu in the top left corner and select IAM &amp; Admin &gt; Service Accounts.</p> <p></p> </li> <li> <p>Select the + Create Service Account button.</p> </li> <li> <p>In the Create service account field, fill in fields:</p> <ul> <li>Service account name</li> <li>Service account ID (generated automatically)</li> <li>Service account description.</li> </ul> <p></p> </li> <li> <p>Select Create and continue.</p> </li> <li> <p>Set Permissions to Owner.</p> <p></p> </li> <li> <p>Do not set any Principals with access.</p> </li> <li> <p>Select Done to create the service account.</p> </li> <li> <p>Select the newly created service account.</p> <p>For example: example-documentation@exampledocumentation.iam.gserviceaccount.com.</p> </li> <li> <p>Select Add key &gt; Create new key and select JSON. A JSON file with the key is downloaded to your computer.</p> <p>Warning</p> <p>Make sure that you store the key safely. This key provides access to all Google Analytics properties that you have granted.</p> </li> </ol>"},{"location":"#step-4-grant-access-to-the-service-account","title":"Step 4: Grant Access to the Service Account","text":"<p>For the service account to access your Google Analytics data, you need to grant access to the Google Analytics property.</p> <p>To grant access to the service account:</p> <ol> <li> <p>Open Google Analytics.</p> </li> <li> <p>Open the Google Analytics property that you want to connect to. Select the name of the property in the top right of Google Analytics. In the following image, the property is called GA4 - Google Merch Shop.</p> <p></p> </li> <li> <p>Select Admin in the bottom left corner.</p> </li> <li> <p>In the Property column, select Property Access Management.</p> <p></p> </li> <li> <p>Select the + button to add a new user.</p> </li> <li> <p>Enter the service account, in this example example-documentation@exampledocumentation.iam.gserviceaccount.com, and then select Add.</p> <p>Note</p> <p>You can share this email account with business partners and other users that you want to have access to your analytics data. There are no secrets or keys included in the email address.</p> </li> </ol>"},{"location":"#step-5-validation","title":"Step 5: Validation","text":"<p>You should now be able to access data by calling the Google Analytics Data API. To validate this, we will query the number of active users in the last 7 days by calling the <code>runReport</code> endpoint using curl.</p> <p>The <code>runReport</code> endpoint is used to fetch analytics data, like user counts, sessions, countries, and events for a Google Analytics property. This guide does not cover the full details of how to use the Google Analytics Data API. For full information on the endpoints request and response structure, see the <code>runReport</code> documentation. For instructions on how to work with the Google Analytics Data API, see the Google Analytics Data API documentation.</p> <p>To call <code>runReport</code> using curl:</p> <ol> <li> <p>Create an access token using gcloud and the JSON service account key file you downloaded in Create Service Account and Keys. </p> <p>Execute the commands below in your terminal. Replace <code>your-service-account-key.json</code> with the path to your service account key file.</p> <pre><code>gcloud auth activate-service-account --key-file=your-service-account-key.json\n\ngcloud auth print-access-token\n</code></pre> <p>The token to be used in the <code>Authorization: Bearer &lt;YOUR_ACCESS_TOKEN&gt;</code> header is printed.</p> </li> <li> <p>Get your Google Analytics Property ID. You can find it in the Google Analytics Admin section under Property Settings. It has the following format: G-XXXXXXXXXX.</p> </li> <li> <p>Use the below curl command to make the call. Replace <code>YOUR_PROPERTY_ID</code> with your Google Analytics property ID, and <code>YOUR_ACCESS_TOKEN</code> with the access token you have created.</p> <p><pre><code>curl -X POST \\\n\"https://analyticsdata.googleapis.com/v1beta/properties/YOUR_PROPERTY_ID:runReport\" \\\n-H \"Authorization: Bearer $YOUR_ACCESS_TOKEN\" \\\n-H \"Content-Type: application/json\" \\\n-d '{\n    \"dimensions\": [{\"name\": \"date\"}, {\"name\": \"country\"}],\n    \"metrics\": [{\"name\": \"activeUsers\"}],\n    \"dateRanges\": [{\"startDate\": \"7daysAgo\", \"endDate\": \"today\"}]\n}'\n</code></pre> In the above example fields <code>dimensions</code>, <code>metrics</code>, and <code>dateRanges</code> are used to specify the data to retrieve. The dimensions are <code>date</code> and <code>country</code>, the metric is <code>activeUsers</code>, and the date range is set to the last 7 days.</p> <p>More fields can be added to the request, see the <code>runReport</code> documentation for more information.</p> </li> <li> <p>Validate the response:</p> <ul> <li> <p>If successful, you should receive an output similar to what is shown below. For more information on the response structure of <code>runReport</code> see the RunReportResponse documentation.</p> <pre><code>{\n\"dimensionHeaders\": [\n    {\"name\": \"date\"},\n    {\"name\": \"country\"}\n],\n\"metricHeaders\": [\n    {\"name\": \"activeUsers\", \"type\": \"TYPE_INTEGER\"}\n],\n\"rows\": [\n    {\n    \"dimensionValues\": [{\"value\": \"20250717\"}, {\"value\": \"United States\"}],\n    \"metricValues\": [{\"value\": \"1234\"}]\n    },\n    ...\n]\n}\n</code></pre> </li> <li> <p>If unsuccessful, you will receive an error message. Common errors include:</p> <ul> <li><code>insufficientPermissions</code>: This means that the service account does not have access to the Google Analytics property. Make sure you have granted access to the service account in Create Service Account and Keys.</li> <li><code>invalidParameter</code>: This means that there is an issue with the request parameters. Check that you have provided the correct property ID and that the request body is correctly formatted.</li> </ul> </li> </ul> </li> </ol>"},{"location":"webb-app-ci-cd/","title":"CI/CD for the Translator web app","text":""},{"location":"webb-app-ci-cd/#introduction","title":"Introduction","text":"<p>The Continuous Integration and Continuous Delivery (CI/CD) pipeline for the Translator web app automates the build, test, and deploy processes using Azure services. It ensures consistent build environments, verifies functionality through integration tests, and continuously deploys the app to Azure App Service.</p>"},{"location":"webb-app-ci-cd/#cicd-components","title":"CI/CD components","text":"<p>Files at the root of the repository:</p> <ul> <li><code>azure-pipelines.yml</code>: Defines the CI/CD pipeline, including its stages, jobs, steps, triggers, and configuration.</li> <li><code>Dockerfile</code>: Specifies how to build the Docker image, including the Python version, the path to <code>requirements.txt</code>, and the app's startup commands.</li> <li><code>requirements.txt</code>: Lists the Python packages the app depends on.</li> <li><code>test.xml</code>: Documentation XML file used during integration tests.</li> </ul> <p>Azure services:</p> <ul> <li>Azure Pipelines: Builds, tests, and deploys the code as defined in <code>azure-pipelines.yml</code>.</li> <li>Azure Key Vault: Stores the app\u2019s keys and secrets, such as the Foundry Translator Resource API key.</li> <li>Azure Container Registry: Stores Docker images. Added as a Service Connection to the Azure DevOps project.</li> <li>Azure App Services: Hosts the web app.</li> </ul> <p>See Read more for additional details about these services and concepts.</p>"},{"location":"webb-app-ci-cd/#pipeline-stages","title":"Pipeline stages","text":"<p>The <code>azure-pipelines.yml</code> file defines the pipeline stages.</p>"},{"location":"webb-app-ci-cd/#trigger","title":"Trigger","text":"<p>The pipeline triggers when code is merged to the <code>main</code> branch. </p>"},{"location":"webb-app-ci-cd/#stage-1-build","title":"Stage 1: Build","text":"<p>The pipeline downloads the code and runs <code>docker build</code>. If successful, the Docker image is pushed to the Azure Container Registry. If the build fails, the pipeline stops, and you can view the details in the pipeline logs.</p>"},{"location":"webb-app-ci-cd/#stage-2-integration-test","title":"Stage 2: Integration test","text":"<p>This stage runs if the build is successful. The <code>AzureKeyVault@2</code> task connects to Azure Key Vault and download the required keys as masked environment variables. The pipeline then runs the Docker container locally followed by the tests in the <code>script</code> blocks. For information on what each test does, see comments in <code>azure-pipelines.yml</code>. If any test fails, the pipeline stops, and you can view the details in the pipeline logs. </p>"},{"location":"webb-app-ci-cd/#stage-3-deployment","title":"Stage 3: Deployment","text":"<p>After a successful integration test, the pipeline deploys the Docker image to the Azure App Service. </p>"},{"location":"webb-app-ci-cd/#procedures","title":"Procedures","text":""},{"location":"webb-app-ci-cd/#troubleshoot-pipeline-failures","title":"Troubleshoot pipeline failures","text":"<p>To identify and fix pipeline failures:</p> <ol> <li>Sign in to the Azure DevOps portal. </li> <li>Select Pipelines.</li> <li>Select translator-azure-pipeline.</li> <li>In the list of runs, select the failed run, marked with a red X. </li> <li>In the run summary, select the failed job.</li> <li>In the task list, select the failed task, highlighted in red. The log pane displays the console output.</li> </ol>"},{"location":"webb-app-ci-cd/#set-up-notifications-for-pipeline-failures","title":"Set up notifications for pipeline failures","text":"<p>To receive an email with a direct link to the failed pipeline run:</p> <ol> <li>Sign in to the Azure DevOps portal.  </li> <li>Select Project Settings &gt; Notifications.</li> <li>Select + New subscription.</li> <li>Select A build fails as the Template, and then select Next.</li> <li>Select Finish.</li> </ol>"},{"location":"webb-app-ci-cd/#edit-app-keys","title":"Edit app keys","text":"<p>To update, add, or remove app keys:</p> <ol> <li>Sign in to the Microsoft Azure portal.</li> <li>Search for and select Key Vaults.</li> <li>Filter for resource-group-translator and select the key vault.</li> <li>Do one of the following:<ul> <li>Add a key: Select Create a key.</li> <li>Update a key: Select + New Version. </li> <li>Remove a key: Select Delete.</li> </ul> </li> </ol>"},{"location":"webb-app-ci-cd/#update-build-requirements","title":"Update build requirements","text":"<ul> <li> <p>Python version: Open the <code>Dockerfile</code> and update the <code>FROM python:&lt;version&gt;-slim</code> parameter.</p> </li> <li> <p>Packages: Open <code>requirements.txt</code> to add, update, or remove package dependencies.</p> </li> </ul>"},{"location":"webb-app-ci-cd/#add-integration-tests","title":"Add integration tests","text":"<p>Integration test logic is defined in the <code>azure-pipelines.yml</code> file.</p> <p>To test additional files or endpoints:</p> <ol> <li>Locate the <code>script</code> block that contains the <code># Test endpoints</code> comment.</li> <li>Add the new test in that <code>script</code>  block. Follow the <code>echo</code> and <code>curl</code> pattern used in <code>\"Test 1: Standard XML Translation\"</code> and <code>\"Test 2: Health Check\"</code>.</li> </ol> <p>Example: <pre><code>- script: |\n   # Test endpoints\n   # ... (Docker run logic) ...\n\n   # Tests the translate endpoint passing the test.xml file. Any non-200 HTTP response fails this stage.    \n   echo \"Test 1: Standard XML Translation\"\n   curl -X POST http://localhost:8000/translate \\\n      -H \"Content-Type: application/xml\" \\\n      -d @tests/test.xml --fail\n\n   echo \"Test 2: Health Check\"\n   curl -f http://localhost:8000/health || exit 1\n</code></pre></p> <p>To test complex logic: </p> <ol> <li>Add a Python script to the <code>tests</code> folder in the repository.</li> <li>Add a new <code>script</code> block in <code>azure-pipelines.yml</code> with commands to install Python on the build agent and run your script after the container starts. Follow the pattern used in <code>task: UsePythonVersion@0</code>.</li> </ol> <p>Example: <pre><code>- task: UsePythonVersion@0\n   inputs:\n      versionSpec: '3.x'\n\n   - script: |\n      # Start container as before\n      docker run -d -p 8000:8000 --name test-app -e API_KEY=$(TRANSLATION-API-KEY) $(image)\n      sleep 10\n\n      # Install dependencies and run the script\n      pip install requests\n      python tests/integration_test.py\n      displayName: 'Run Python Integration Tests'\n</code></pre></p>"},{"location":"webb-app-ci-cd/#read-more","title":"Read More","text":"<ul> <li>Azure Pipelines</li> <li>Azure Container Registry</li> <li>Azure Key Vault</li> <li>Azure App Services</li> <li>Docker, Building an image</li> </ul>"}]}